<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Progress Dashboard – Gantt (New UI)</title>
  <style>
    :root{
      --bg:#0a0f18; --panel:#0f1624; --panel-2:#0c1220; --ink:#e9f0ff; --dim:#a6b5cc;
      --line:#1e2a44; --grid:#16223a; --accent:#6cc5ff; --accent2:#8dffcf;
      --red:#ff6b6b; --amber:#ffb86b; --violet:#c6a5ff; --green:#51d69a; --blue:#5aa8ff;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .app{display:grid;grid-template-columns:300px 1fr;min-height:100vh}
    aside{background:var(--panel-2);border-right:1px solid var(--line);padding:16px;position:sticky;top:0;height:100vh;overflow:auto}
    main{padding:18px}
    h1{font-size:22px;margin:0 0 6px}
    .muted{color:var(--dim);font-size:12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:12px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    button,select,input[type=search]{background:#0e1a33;border:1px solid var(--line);color:var(--ink);border-radius:10px;padding:8px 10px}
    button{cursor:pointer}
    button:hover{background:#132349}
    .legend{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px}
    .lg{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--dim)}
    .dot{width:10px;height:10px;border-radius:999px}
    .stat{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
    .kv{background:#0f1a33;border:1px solid var(--line);border-radius:12px;padding:8px}
    .kv h4{margin:0 0 6px;font-size:12px;color:var(--dim)}
    .kv p{margin:0;font-size:14px}

    .gantt-wrap{display:grid;grid-template-rows:auto 1fr;gap:10px}
    .toolbar{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .toolbar-left{display:flex;gap:8px;align-items:center}
    .toolbar-right{display:flex;gap:8px;align-items:center}
    .table{display:grid;grid-template-columns:280px 1fr;gap:10px}
    .left-col{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);overflow:auto;max-height:70vh}
    .right-col{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);overflow:auto;max-height:70vh}
    .row{display:flex;gap:8px;align-items:center;border-bottom:1px solid var(--line);padding:10px}
    .row:last-child{border-bottom:none}
    .name{font-size:13px}
    .badge{padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:#0e1a33;font-size:11px;color:var(--dim)}

    svg{display:block;min-width:1200px}
    .month-band text{font-size:12px;fill:#cfe2ff}
    .day-band text{font-size:10px;fill:#a6b5cc}
    .today text{font-size:10px;fill:#ff9b9b}
    .tip{position:fixed;z-index:100;pointer-events:none;background:#0b1327;border:1px solid var(--line);padding:8px 10px;border-radius:10px;font-size:12px;color:var(--ink);opacity:0;transition:opacity .08s ease}
  </style>
</head>
<body>
<div class="app">
  <aside>
    <h1>Progress Dashboard</h1>
    <div class="muted" id="subtitle">Gantt view • (auto)</div>
    <div class="legend" id="legend"></div>
    <div class="stat">
      <div class="kv"><h4>Total tasks</h4><p id="statTasks">–</p></div>
      <div class="kv"><h4>Span</h4><p id="statSpan">–</p></div>
    </div>
    <div class="card" style="margin-top:10px">
      <h4 class="muted" style="margin:0 0 8px">Filters</h4>
      <div class="controls">
        <input id="search" type="search" placeholder="Search tasks…" />
        <select id="groupBy">
          <option value="none">Group: None</option>
          <option value="phase">Group: Phase</option>
          <option value="type">Group: Type</option>
        </select>
      </div>
      <div class="controls" style="margin-top:8px">
        <label class="muted" style="display:flex;align-items:center;gap:6px"><input id="toggleDays" type="checkbox" /> Show daily dates</label>
      </div>
    </div>
  </aside>

  <main>
    <div class="gantt-wrap">
      <div class="toolbar">
        <div class="toolbar-left">
          <button id="zoomOut">–</button>
          <span class="badge" id="zoomLevel">Day scale</span>
          <button id="zoomIn">+</button>
        </div>
        <div class="toolbar-right">
          <button id="exportPNG"></button>
        </div>
      </div>

      <div class="table">
        <div class="left-col" id="left"></div>
        <div class="right-col"><svg id="gantt" xmlns="http://www.w3.org/2000/svg"></svg></div>
      </div>
    </div>
  </main>
</div>
<div class="tip" id="tip"></div>

<script>
// ——— Task Data (previous plan + new items) ———
const tasks = [
  // Reference items
  t('Topic exploration & selection','2025-06-02','2025-06-18','task','Planning'),
  t('Preliminary Literature Survey','2025-06-19','2025-06-26','task','Planning'),
  t('First Review','2025-06-27','2025-06-27','milestone','Reviews'),
  t('Topic refinement & tool exploration','2025-06-30','2025-07-20','task','Planning'),
  t('Collection of datasets (Phase 1)','2025-06-30','2025-07-07','task','Data'),
  t('Collection of datasets (Phase 2)','2025-07-14','2025-07-21','task','Data'),
  t('Dataset request to Hari Narayanan','2025-07-22','2025-07-22','milestone','Data'),
  t('Weekly Meeting with Dr Bagyammal','2025-06-23','2025-06-23','milestone','Meetings'),
  t('Weekly Meeting with Dr Bagyammal','2025-06-30','2025-06-30','milestone','Meetings'),
  t('Weekly Meeting with Dr Bagyammal','2025-07-08','2025-07-08','milestone','Meetings'),
  t('Weekly Meeting with Dr Bagyammal','2025-07-15','2025-07-15','milestone','Meetings'),
  t('Weekly Meeting with Dr Bagyammal','2025-07-25','2025-07-25','milestone','Meetings'),
  // New items
  t('Meeting with Dr Bagyammal','2025-08-01','2025-08-01','milestone','Meetings'),
  t('Data scraping – Sangeetapriya datasets','2025-08-04','2025-08-09','task','Data'),
  t('Guide Review 2','2025-09-17','2025-09-17','milestone','Reviews'),
  t('Setting up the data preprocessing pipeline','2025-09-13','2025-09-20','task','Data'),
  t('Configuration of transcription model','2025-09-16','2025-09-25','task','Modeling'),
  t('I/O format for transcription model','2025-09-18','2025-09-22','task','Modeling'),
  t('Setting up the classification model','2025-09-21','2025-10-02','task','Modeling'),
  // ——— Phase 1: Preparation & Data ———
  t('Activity 8','2025-10-29','2025-11-03','task','Phase 1: Preparation & Data'),
  t('Data Collection','2025-11-01','2025-11-11','task','Phase 1: Preparation & Data'),
  t('Activity 9','2025-11-07','2025-11-09','task','Phase 1: Preparation & Data'),
  t('Dataset Preprocessing','2025-11-12','2025-11-30','task','Phase 1: Preparation & Data'),
  t('Activity 10','2025-11-13','2025-12-13','task','Phase 1: Preparation & Data'),
  t('Activity 11','2025-11-15','2025-12-08','task','Phase 1: Preparation & Data'),
  t('Transcription Model Improvement','2025-11-20','2025-11-30','task','Phase 1: Preparation & Data'),
  t('Activity 12','2025-11-23','2025-11-28','task','Phase 1: Preparation & Data'),

  // ——— Phase 2: Core Work ———
  t('Transcription of preprocessed data','2025-12-01','2025-12-08','task','Phase 2: Core Work'),
  t('First Training Run','2025-12-09','2025-12-19','task','Phase 2: Core Work'),
  t('Documentation of First Run Results','2025-12-20','2026-01-19','task','Phase 2: Core Work'),
  t('Improvements to Model','2025-12-20','2026-01-19','task','Phase 2: Core Work'),

  // ——— Phase 3: Extended Development ———
  t('Literature Survey (parallel with improvements)','2026-01-05','2026-01-15','task','Phase 3: Extended Development'),
  t('Second Training Run','2026-01-20','2026-02-10','task','Phase 3: Extended Development'),
  t('Third Training Run','2026-02-11','2026-02-28','task','Phase 3: Extended Development'),

  // ——— Phase 4: Wrap-up & Deliverables ———
  t('Final Improvements + Validation','2026-03-01','2026-03-07','task','Phase 4: Wrap-up & Deliverables'),
  t('Paper Writing (first full draft before ISMIR prep)','2026-03-08','2026-03-15','task','Phase 4: Wrap-up & Deliverables')
].map((d,i)=>({...d,id:i+1}));

function t(name,start,end,type='task',phase='General'){
  return { name, start:new Date(start), end:new Date(end), type, phase };
}

const PHASE_COLORS = {
  'Planning':'#5aa8ff','Data':'#51d69a','Modeling':'#c6a5ff','Meetings':'#ffb86b','Reviews':'#ff6b6b','General':'#6cc5ff',
  'Phase 1: Preparation & Data':'#7dd3fc',
  'Phase 2: Core Work':'#fca5a5',
  'Phase 3: Extended Development':'#fde68a',
  'Phase 4: Wrap-up & Deliverables':'#86efac'
};

// ——— Elements & Setup ———
const svg = document.getElementById('gantt');
const left = document.getElementById('left');
const tip = document.getElementById('tip');
const search = document.getElementById('search');
const groupBySel = document.getElementById('groupBy');
const showDays = document.getElementById('toggleDays');
let scale = 26; // px per day
const ROW_H = 34; const HEADER_H = 44; const MONTH_H = 28; const DAY_H = 18; const PADDING_L = 8;

// util
function daysBetween(a,b){
  return Math.round((Date.UTC(b.getFullYear(),b.getMonth(),b.getDate()) - Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()))/86400000);
}
function addDays(d,n){ const r = new Date(d); r.setDate(r.getDate()+n); return r; }
function fmt(d){ return d.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'2-digit'}); }
function computeRange(list){
  let s = list.reduce((m,t)=> t.start < m ? t.start : m, list[0].start);
  let e = list.reduce((m,t)=> t.end > m ? t.end : m, list[0].end);
  s = addDays(s,-3); e = addDays(e,3); return {start:s,end:e};
}
function fmtShort(d){ return d.toLocaleDateString(undefined,{month:'short', year:'numeric'}); }

function buildLegend(){
  const el = document.getElementById('legend');
  el.innerHTML = '';
  Object.entries(PHASE_COLORS).forEach(([k,v])=>{
    const item = document.createElement('div');
    item.className = 'lg';
    item.innerHTML = `<span class="dot" style="background:${v}"></span>${k}`;
    el.appendChild(item);
  });
}

function render(){
  const q = (search.value||'').toLowerCase();
  const groupBy = groupBySel.value;
  const filtered = tasks.filter(t=> t.name.toLowerCase().includes(q) || t.phase.toLowerCase().includes(q));

  // stats
  const rangeAll = computeRange(filtered.length?filtered:tasks);
  document.getElementById('statTasks').textContent = filtered.length;
  document.getElementById('statSpan').textContent = `${fmt(rangeAll.start)} → ${fmt(rangeAll.end)}`;
  const subtitle = document.getElementById('subtitle'); if(subtitle){ subtitle.textContent = `Gantt view • ${fmtShort(rangeAll.start)} → ${fmtShort(rangeAll.end)}`; }

  // grouping
  let rows = [];
  if(groupBy==='none'){
    rows = filtered;
  } else {
    const groups = {};
    for(const tk of filtered){ (groups[tk[groupBy]] = groups[tk[groupBy]] || []).push(tk); }
    rows = Object.entries(groups)
      .sort(([a],[b])=> a.localeCompare(b))
      .flatMap(([g,list])=> [{isGroup:true,name:g}, ...list]);
  }

  const range = computeRange(filtered.length?filtered:tasks);
  const totalDays = Math.max(1,daysBetween(range.start, range.end)+1);

  // left list
  left.innerHTML = '';
  rows.forEach(r=>{
    const d = document.createElement('div'); d.className = 'row';
    if(r.isGroup){ d.style.background='#0c1430'; d.style.fontWeight=600; d.innerHTML = `<span class="name">${r.name}</span>`; }
    else {
      d.innerHTML = `<span class="dot" style="background:${PHASE_COLORS[r.phase]};border-radius:999px;width:10px;height:10px"></span><span class="name">${r.name}</span>`;
    }
    left.appendChild(d);
  });

  // svg size & clear
  const height = rows.length * ROW_H + HEADER_H + MONTH_H + (showDays.checked?DAY_H:0);
  const width  = totalDays * scale + PADDING_L*2 + 60;
  svg.setAttribute('viewBox',`0 0 ${width} ${height}`);
  svg.setAttribute('width', width); svg.setAttribute('height', height);
  while(svg.firstChild) svg.removeChild(svg.firstChild);

  // bands
  const originX = PADDING_L; const originY = HEADER_H + MONTH_H + (showDays.checked?DAY_H:0);
  const bg = rect(0,0,width,height,'#0f1624'); svg.appendChild(bg);

  // Months
  const months=[]; let cursor=new Date(range.start);
  while(cursor<=range.end){
    const mStart=new Date(cursor.getFullYear(),cursor.getMonth(),1);
    const mEnd=new Date(cursor.getFullYear(),cursor.getMonth()+1,0);
    const s = cursor<mStart?cursor:mStart; const e = mEnd<range.end?mEnd:range.end;
    months.push({label:s.toLocaleString(undefined,{month:'long',year:'numeric'}), start:s,end:e});
    cursor=new Date(cursor.getFullYear(),cursor.getMonth()+1,1);
  }
  const monthBand = group('month-band'); svg.appendChild(monthBand);
  months.forEach(m=>{
    const x = originX + daysBetween(range.start,m.start)*scale;
    const w = (daysBetween(m.start,m.end)+1)*scale;
    const r = rect(x, HEADER_H, w, MONTH_H, '#0d1832'); r.setAttribute('stroke', '#1c2a4a'); monthBand.appendChild(r);
    monthBand.appendChild(text(x+10, HEADER_H+18, m.label,12,'#cfe2ff'));
  });

  // optional day labels
  if(showDays.checked){
    const dayBand = group('day-band'); svg.appendChild(dayBand);
    for(let d=0; d<totalDays; d++){
      const x = originX + d*scale;
      dayBand.appendChild(text(x+4, HEADER_H+MONTH_H+14, addDays(range.start,d).getDate(),10,'#a6b5cc'));
    }
  }

  // Grid & today line
  const grid = group(); svg.appendChild(grid);
  for(let d=0; d<totalDays; d++){
    const x = originX + d*scale;
    const col = (addDays(range.start,d).getDay()===1)?'#1e355e':'#17243e'; // darker line at Mondays
    grid.appendChild(line(x, originY, x, height, col));
  }
  const today = new Date();
  if(today>=range.start && today<=range.end){
    const xt = originX + daysBetween(range.start,today)*scale + scale/2;
    const g = group('today'); g.appendChild(line(xt, HEADER_H, xt, height, '#ff6b6b', 2)); g.appendChild(text(xt+6, HEADER_H+12,'Today',10,'#ff9b9b')); svg.appendChild(g);
  }

  // Rows & bars
  rows.forEach((r,i)=>{
    const y = originY + i*ROW_H + 6;
    svg.appendChild(line(0, y+ROW_H-8, width, y+ROW_H-8, '#13213a'));
    if(r.isGroup) return;
    const x = originX + daysBetween(range.start,r.start)*scale;
    const w = Math.max(1,daysBetween(r.start,r.end)+1)*scale;
    const color = PHASE_COLORS[r.phase] || '#6cc5ff';
    if(r.type==='milestone'){
      const cx = x + w/2, cy = y + 10;
      const d = poly([[cx,cy-9],[cx+9,cy],[cx,cy+9],[cx-9,cy]], color); d.setAttribute('stroke','#0a1228'); d.setAttribute('stroke-width','1');
      d.dataset.tip = `${r.name}\n${fmt(r.start)}`; bindTip(d); svg.appendChild(d);
    } else {
      const bar = rect(x,y,w,18,color,6); bar.dataset.tip = `${r.name}\n${fmt(r.start)} → ${fmt(r.end)}\nPhase: ${r.phase}`; bindTip(bar); svg.appendChild(bar);
    }
  });
}

// svg helpers
function group(cls){ const g=document.createElementNS('http://www.w3.org/2000/svg','g'); if(cls) g.setAttribute('class',cls); return g; }
function rect(x,y,w,h,fill,rx=6){ const r=document.createElementNS('http://www.w3.org/2000/svg','rect'); r.setAttribute('x',x); r.setAttribute('y',y); r.setAttribute('width',w); r.setAttribute('height',h); r.setAttribute('fill',fill); r.setAttribute('rx',rx); r.setAttribute('ry',rx); return r; }
function line(x1,y1,x2,y2,stroke='#1b2a49',sw=1){ const l=document.createElementNS('http://www.w3.org/2000/svg','line'); l.setAttribute('x1',x1); l.setAttribute('y1',y1); l.setAttribute('x2',x2); l.setAttribute('y2',y2); l.setAttribute('stroke',stroke); l.setAttribute('stroke-width',sw); return l; }
function text(x,y,txt,size=12,fill='#fff'){ const t=document.createElementNS('http://www.w3.org/2000/svg','text'); t.setAttribute('x',x); t.setAttribute('y',y); t.setAttribute('fill',fill); t.setAttribute('font-size',size); t.textContent = txt; return t; }
function poly(points,fill){ const p=document.createElementNS('http://www.w3.org/2000/svg','polygon'); p.setAttribute('points',points.map(pt=>pt.join(',')).join(' ')); p.setAttribute('fill',fill); return p; }

// tooltip
function bindTip(el){
  el.addEventListener('mousemove', e=>{ tip.style.opacity=1; tip.innerText=el.dataset.tip||''; tip.style.left=(e.clientX+12)+'px'; tip.style.top=(e.clientY+12)+'px'; });
  el.addEventListener('mouseleave', ()=> tip.style.opacity=0 );
}

// controls
function setZoom(delta){
  scale = Math.min(60, Math.max(8, scale + delta));
  document.getElementById('zoomLevel').textContent = (scale>=40?'Hour-ish scale': scale>=24?'Day scale':'Coarse scale');
  render();
}
document.getElementById('zoomIn').onclick = ()=> setZoom(+6);
document.getElementById('zoomOut').onclick = ()=> setZoom(-6);
search.addEventListener('input', render);
groupBySel.addEventListener('change', render);
showDays.addEventListener('change', render);

// export
const svgEl = document.getElementById('gantt');
document.getElementById('exportPNG').addEventListener('click', ()=>{
  const xml = new XMLSerializer().serializeToString(svgEl);
  const svg64 = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(xml)));
  const img = new Image();
  img.onload = ()=>{
    const canvas = document.createElement('canvas');
    canvas.width = svgEl.viewBox.baseVal.width; canvas.height = svgEl.viewBox.baseVal.height;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#0f1624'; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0);
    const url = canvas.toDataURL('image/png');
    const a = document.createElement('a'); a.href = url; a.download = 'gantt_new_ui.png'; a.click();
  };
  img.src = svg64;
});

buildLegend();
render();
</script>
</body>
</html>
